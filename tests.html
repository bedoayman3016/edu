<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edumate â€” Empower Your Future</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
   :root{ 
        --header-height:64px; 
        --sidebar-width:280px; 
        --sidebar-collapsed-width:80px; 
        --primary:#8B5CF6; 
        --primary-dark:#5A4BD6; 
        --accent:#A855F7; 
        --background: linear-gradient(180deg, var(--primary) 0%, var(--accent) 100%); 
        --card:#FFFFFF; 
        --muted:#6B7280; 
        --border:#E6E9F2; 
    }
    .dark-theme { 
        --primary: #8B5CF6; 
        --primary-dark: #6D28D9; 
        --accent:#9F7AEA; 
        --background: linear-gradient(180deg, #0f0b20 0%, #1a0f24 100%); 
        --card: #1a0f24; 
        --muted: #94A3B8; 
        --border: rgba(255, 255, 255, 0.1); 
        color: #e2e8f0; 
    }
    *{box-sizing:border-box} 
    html,body{
        height:100%;
        margin:0;
        font-family:Inter,system-ui,sans-serif;
        color:#111827;
        background:var(--background);
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-size: cover;
    } 
    a{color:inherit;text-decoration:none}
    
    /* HEADER */
    .header{
        position:fixed;
        top:0;
        left:0;
        right:0;
        height:var(--header-height);
        display:flex;
        align-items:center;
        justify-content:space-between;
        padding:0 20px;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px) saturate(180%);
        -webkit-backdrop-filter: blur(10px) saturate(180%);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }
    
    .dark-theme .header {
        background: rgba(15, 23, 42, 0.85);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }
    
    .logo{
        display:flex;
        align-items:center;
        gap:12px;
        font-weight:700;
        color: var(--primary-dark);
    } 
    
    .dark-theme .logo {
        color: #e2e8f0;
    }
    
    .logo img{
        height:36px;
        border-radius:6px
    }
    
    .nav-links{
        display:flex;
        gap:16px;
        align-items:center
    } 
    
    .nav-links a{
        padding:8px 10px;
        border-radius:10px;
        color:var(--muted);
        font-weight:600;
        font-size:0.95rem;
        transition: all 0.2s ease;
    }
    
    .nav-links a:hover {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
    }
    
    .controls{
        display:flex;
        gap:10px;
        align-items:center
    }
    
    .btn{
        background:linear-gradient(135deg,var(--primary),var(--primary-dark));
        color:white;
        padding:9px 16px;
        border-radius:12px;
        border:0;
        font-weight:600;
        cursor:pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    
    .link-btn{
        background:transparent;
        border:1px solid var(--primary);
        color:var(--primary);
        padding:9px 14px;
        border-radius:12px;
        font-weight:600;
        cursor:pointer;
        transition: all 0.2s ease;
    }
    
    .link-btn:hover {
        background: rgba(99, 102, 241, 0.1);
    }
    
    .btn-icon{
        background:transparent;
        border:0;
        font-size:1.2rem;
        padding:8px;
        border-radius:10px;
        cursor:pointer;
        color: var(--muted);
        transition: all 0.2s ease;
    }
    
    .btn-icon:hover {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
    }
    
    /* SIDEBAR */
    .sidebar{
        position:fixed;
        top:var(--header-height);
        left:0;
        bottom:0;
        width:var(--sidebar-width);
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px) saturate(180%);
        -webkit-backdrop-filter: blur(12px) saturate(180%);
        border-right: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 5px 0 30px rgba(0, 0, 0, 0.05);
        padding: 20px;
        overflow-y: auto;
        z-index: 999;
        transition: all 0.3s ease;
    }
    
    .sidebar.collapsed {
        width: var(--sidebar-collapsed-width);
    }
    
    .sidebar.collapsed .nav-item span:not(:first-child),
    .sidebar.collapsed .sidebar-profile > div,
    .sidebar.collapsed .nav-item-text {
        display: none;
    }
    
    .dark-theme .sidebar {
        background: rgba(15, 23, 42, 0.8);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 5px 0 30px rgba(0, 0, 0, 0.3);
    }
    
    .sidebar-profile{
        display:flex;
        gap:12px;
        align-items:center;
        padding-bottom:12px;
        border-bottom:1px solid rgba(99, 102, 241, 0.2);
        margin-bottom:16px;
        transition: all 0.3s ease;
    }
    
    .dark-theme .sidebar-profile {
        border-bottom:1px solid rgba(255, 255, 255, 0.1);
    }
    
    .profile-pic{
        width:44px;
        height:44px;
        border-radius:50%;
        object-fit:cover;
        border:2px solid var(--primary)
    }
    
    .nav-item{
        display:flex;
        gap:12px;
        align-items:center;
        padding:12px 14px;
        border-radius:12px;
        cursor:pointer;
        font-weight:600;
        color:var(--muted);
        transition: all 0.2s ease;
        margin-bottom: 8px;
    } 
    
    .nav-item:hover{
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
        transform: translateX(4px);
    }
    
    .nav-item.active {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
        color: var(--primary);
        border-left: 3px solid var(--primary);
    }
    
    /* MAIN CONTENT AREA - FIXED */
    .main-content {
        margin-top: calc(var(--header-height) + 20px);
        margin-left: calc(var(--sidebar-width) + 20px);
        margin-right: 20px;
        padding: 30px;
        min-height: calc(100vh - var(--header-height) - 40px);
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: margin-left 0.3s ease;
    }
    
    .main-content.shifted {
        margin-left: calc(var(--sidebar-collapsed-width) + 20px);
    }
    
    .dark-theme .main-content {
        background: rgba(15, 23, 42, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #e2e8f0;
    }
    
    .header, .sidebar, .nav-item, .btn, .nav-links a {
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
    
    /* Page Styling */
    .page{display:none;width:100%} 
    .page.active{display:block}
    .card{background:var(--card);border-radius:16px;padding:24px;border:1px solid var(--border);box-shadow:0 8px 24px rgba(15,23,42,0.05);margin-bottom:20px}
    .dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px}
    
    .input{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:var(--card);width:100%;font-family:inherit;font-size:0.95rem}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .avatar-large{width:110px;height:110px;border-radius:16px;object-fit:cover;border:2px solid var(--border)}
    
    .login-root{min-height:calc(100vh - var(--header-height) - 40px);display:flex;align-items:center;justify-content:center;padding:24px}
    .login-card{width:100%;max-width:480px;border-radius:20px;padding:40px;background:var(--card);box-shadow:0 30px 60px rgba(99,102,241,0.15);border:1px solid rgba(255,255,255,0.3)}
    .socials{display:flex;gap:12px;margin-top:16px}
    .social-btn{flex:1;padding:12px;border-radius:12px;border:1px solid var(--border);background:white;display:flex;align-items:center;justify-content:center;gap:10px;cursor:pointer;font-weight:600;transition: all 0.2s ease}
    .social-btn:hover {transform: translateY(-2px);box-shadow: 0 4px 12px rgba(0,0,0,0.1)}
    .or-sep{text-align:center;font-size:0.85rem;color:var(--muted);margin:20px 0;position:relative}
    
    .hero{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;padding:50px;border-radius:20px;text-align:center;margin-bottom:30px}
    .hero h1{font-size:2.8rem;margin-bottom:15px}
    
    .ai-bubble{position:fixed;right:24px;bottom:24px;background:var(--primary);color:white;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;cursor:pointer;z-index:70;box-shadow:0 8px 24px rgba(108,92,231,0.4);transition: all 0.3s ease}
    .ai-bubble:hover {transform: scale(1.1)}
    .ai-popup{position:fixed;right:24px;bottom:100px;width:380px;background:var(--card);border-radius:16px;border:1px solid var(--border);box-shadow:0 20px 40px rgba(0,0,0,0.25);display:none;z-index:75;overflow:hidden} 
    .ai-popup.active{display:block}
    .chat-output{padding:16px;max-height:300px;overflow:auto;background:var(--card)}
    .event-card{display:flex;gap:20px;align-items:flex-start;margin-bottom:20px} 
    .event-card img{width:160px;height:120px;object-fit:cover;border-radius:12px;flex-shrink:0}

    @media (max-width:900px){ 
        .sidebar{display:none} 
        .main-content{margin-left:20px}
        .nav-links{display:none}
    }
    
    /* Smooth transitions */
    .page, .card, .btn, .input, .nav-item {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
  </style>
</head>

<body>

  <header class="header">
    <div class="logo"><img src="Edumate.logo-removebg-preview (1).png" alt="Logo" onerror="this.style.display='none'"> EduMate</div>
    <nav class="nav-links">
        <a href="#" onclick="showPage('welcome')">Welcome</a>
        <a href="#" onclick="showPage('home')">Home</a>
        <a href="#" onclick="showPage('faculty')">Faculty</a>
        <a href="#" onclick="showPage('events')">Events</a>
    </nav>
    <div class="controls">
      <button id="theme-toggle" class="btn-icon">ðŸŒ™</button>
      <button id="sidebar-toggle" class="btn-icon">â˜°</button>
    </div>
  </header>

  <nav id="sidebar" class="sidebar">
    <div class="sidebar-profile">
      <img id="profile-pic" class="profile-pic" src="https://via.placeholder.com/44/6C5CE7/FFFFFF?text=U">
      <div>
        <div id="profile-name" style="font-weight:700">Guest</div>
        <div style="font-size:0.85rem;color:var(--muted)">Student</div>
      </div>
    </div>
    <div class="nav-item" onclick="showPage('dashboard')"><span>ðŸ“Š</span> <span class="nav-item-text">Dashboard</span></div>
    <div class="nav-item" onclick="showPage('faculty')"><span>ðŸŽ“</span> <span class="nav-item-text">Faculty</span></div>
    <div class="nav-item" onclick="showPage('events')"><span>ðŸŽŸ</span> <span class="nav-item-text">Events</span></div>
    <div class="nav-item" onclick="showPage('resume')"><span>ðŸ“„</span> <span class="nav-item-text">Resume</span></div>
    <div class="nav-item" onclick="showPage('jobs')"><span>ðŸ’¼</span> <span class="nav-item-text">Jobs</span></div>
    <div class="nav-item" onclick="showPage('profile')"><span>ðŸ‘¤</span> <span class="nav-item-text">Profile</span></div>
    <div class="nav-item" onclick="showPage('xai')"><span>ðŸ¤–</span> <span class="nav-item-text">AI Chat</span></div>
    <div class="nav-item" onclick="signOut()"><span>ðŸ”“</span> <span class="nav-item-text">Sign out</span></div>
  </nav>

  <!-- MAIN CONTENT FIXED -->
  <main id="mainContent" class="main-content">

    <section id="welcome" class="page">
      <div class="hero">
        <h1>Welcome to Edumate</h1>
        <p style="font-size:1.3rem;margin-bottom:20px">Your AI-powered career companion</p>
        <button class="btn" onclick="showPage('login')" style="padding:12px 28px;font-size:1.1rem">Get Started</button>
      </div>
    </section>

    <section id="home" class="page">
      <div class="hero">
        <h1>Empower Your Future</h1>
        <p style="font-size:1.3rem">Your AI study companion and career guide.</p>
      </div>
    </section>

    <section id="login" class="page active">
      <div class="login-root">
        <div class="login-card">
          <h2 style="margin-top:0">Welcome back</h2>
          <p style="color:var(--muted);margin-bottom:24px">Sign in to access your Edumate account</p>
          
          <input id="login-email" class="input" placeholder="name@example.com" style="margin-bottom:12px">
          <input id="login-password" class="input" type="password" placeholder="Password" style="margin-bottom:20px">
          
          <div style="display:flex;gap:12px">
            <button class="btn" style="flex:1" onclick="attemptLogin()">Sign in</button>
            <button class="link-btn" style="flex:1" onclick="showPage('register')">Create account</button>
          </div>

          <div class="or-sep">OR CONTINUE WITH</div>

          <div class="socials">
            <button class="social-btn" onclick="firebaseLogin('google')">
                <svg width="20" height="20" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.715H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.448 2.797 1.237 3.935l2.727-2.225z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.682 7.151C4.389 5.018 6.374 3.58 9 3.58z"/></svg>
                Google
            </button>
            
            <button class="social-btn" onclick="firebaseLogin('github')">
              <svg width="20" height="20" viewBox="0 0 16 16" fill="none"><path fill="#111" d="M8 0C3.58 0 0 3.58 0 8a8 8 0 005.47 7.59c.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2 .37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.6 7.6 0 012 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8 8 0 0016 8c0-4.42-3.58-8-8-8z"/></svg> 
              GitHub
            </button>
          </div>
        </div>
      </div>
    </section>

    <section id="register" class="page">
      <div class="card" style="max-width:600px;margin:0 auto">
        <h2>Create Account</h2>
        <input id="reg-name" class="input" placeholder="Full Name" style="margin-bottom:12px">
        <input id="reg-username" class="input" placeholder="Username" style="margin-bottom:12px">
        <input id="reg-email" class="input" placeholder="Email" style="margin-bottom:12px">
        <input id="reg-password" class="input" type="password" placeholder="Password" style="margin-bottom:12px">
        <input id="reg-password-confirm" class="input" type="password" placeholder="Confirm Password" style="margin-bottom:20px">
        <button class="btn" onclick="startRegistration()" style="width:100%">Create Account</button>
        <p style="text-align:center;margin-top:16px;color:var(--muted)">
          Already have an account? <a href="#" onclick="showPage('login')" style="color:var(--primary);font-weight:600">Sign in</a>
        </p>
      </div>
    </section>

    <section id="info" class="page">
        <div class="card" style="max-width:600px;margin:0 auto">
            <h2>Complete Your Profile</h2>
            <img id="info-avatar-preview" class="avatar-large" src="https://via.placeholder.com/110/6C5CE7/FFFFFF?text=U" style="display:block;margin:0 auto 20px"><br>
            <input id="info-profile-pic" type="file" accept="image/*" onchange="previewInfoAvatar(this)" style="margin-bottom:20px;width:100%">
            <input id="info-fullname" class="input" placeholder="Full Name" style="margin-bottom:12px">
            <input id="info-username" class="input" placeholder="Username" style="margin-bottom:12px">
            <input id="info-email" class="input" placeholder="Email" style="margin-bottom:12px">
            <input id="info-education" class="input" placeholder="Education (e.g., B.Sc Computer Science)" style="margin-bottom:12px">
            <input id="info-major" class="input" placeholder="Major" style="margin-bottom:12px">
            <input id="info-gradyear" class="input" placeholder="Graduation Year" style="margin-bottom:12px">
            <input id="info-skills" class="input" placeholder="Skills (e.g., Python, SQL, Leadership)" style="margin-bottom:20px">
            <button class="btn" onclick="completeRegistration()" style="width:100%">Create Account</button>
        </div>
    </section>

    <section id="dashboard" class="page">
        <div class="page-header">
          <h2 style="margin:0">Dashboard</h2>
          <span id="user-name" style="font-weight:600;color:var(--primary)"></span>
        </div>
        <div class="dashboard-grid">
            <div class="card" style="text-align:center">
                <h3>ðŸŽŸ Upcoming Events</h3>
                <p style="color:var(--muted)">3 events this week</p>
                <button class="btn" onclick="showPage('events')" style="margin-top:12px;width:100%">View Events</button>
            </div>
            <div class="card" style="text-align:center">
                <h3>ðŸ’¼ Job Matches</h3>
                <p style="color:var(--muted)">5 new matches</p>
                <button class="btn" onclick="showPage('jobs')" style="margin-top:12px;width:100%">View Jobs</button>
            </div>
            <div class="card" style="text-align:center">
                <h3>ðŸ“„ Resume</h3>
                <p style="color:var(--muted)">ATS Score: 85%</p>
                <button class="btn" onclick="showPage('resume')" style="margin-top:12px;width:100%">Optimize Resume</button>
            </div>
            <div class="card" style="text-align:center">
                <h3>ðŸ¤– AI Assistant</h3>
                <p style="color:var(--muted)">Ask anything about careers</p>
                <button class="btn" onclick="showPage('xai')" style="margin-top:12px;width:100%">Chat with AI</button>
            </div>
        </div>
    </section>

    <section id="faculty" class="page">
        <h2>Faculty Recommendations</h2>
        <div class="dashboard-grid">
            <div class="card">
                <h3>Computer Science</h3>
                <p style="color:var(--muted);margin:8px 0">95% match based on your skills</p>
                <a href="https://sut.edu.eg/academic-fileds/computer-science-technology/" target="_blank" style="text-decoration:none">
                  <button class="btn">Apply</button>
                </a>
            </div>
            
            <div class="card">
                <h3>Data Science</h3>
                <p style="color:var(--muted);margin:8px 0">88% match</p>
                <a href="https://sut.edu.eg/apply-now/" target="_blank" style="text-decoration:none">
                  <button class="btn">Apply</button>
                </a>
            </div>
            
            <div class="card">
                <h3>Cyber Security</h3>
                <p style="color:var(--muted);margin:8px 0">84% match</p>
                <a href="https://sut.edu.eg/apply-now/" target="_blank" style="text-decoration:none">
                  <button class="btn">Apply</button>
                </a>
            </div>
            
            <div class="card">
                <h3>Networks</h3>
                <p style="color:var(--muted);margin:8px 0">95% match</p>
                <a href="https://sut.edu.eg/apply-now/" target="_blank" style="text-decoration:none">
                  <button class="btn">Apply</button>
                </a>
            </div>
            
            <div class="card">
                <h3>Top Recommended University</h3>
                <p style="color:var(--muted);margin:8px 0">100% match for your major</p>
                <a href="https://sut.edu.eg/#" target="_blank" style="text-decoration:none">
                  <button class="btn">Apply</button>
                </a>
            </div>
        </div>
    </section>

    <section id="events" class="page">
        <div class="page-header">
            <h2 style="margin:0">Events</h2>
            <select id="majorSelect" class="input" style="max-width:300px" onchange="loadEventsByMajor()">
                <option value="">Choose Your Major</option>
                <option value="cs">Computer Science</option>
                <option value="masscomm">Mass Communication</option>
                <option value="business">Business</option>
                <option value="engineering">Engineering</option>
                <option value="medicine">Medicine</option>
            </select>
        </div>
        <div id="eventsContainer" style="margin-top:20px">
            <div class="card" style="text-align:center;color:var(--muted);padding:40px">
                <p>Select a major to see relevant events</p>
            </div>
        </div>
    </section>

    <section id="jobs" class="page">
        <h2>Job Recommendations</h2>
        <div id="jobs-list" class="dashboard-grid"></div>
    </section>
    
    <section id="resume" class="page">
        <h2>Resume Builder</h2>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
            <button class="btn" onclick="showResumeForm()">Edit Resume Data</button>
            <button class="btn" onclick="generateResumePreview()">Preview Resume</button>
        </div>

        <!-- Resume template -->
        <div class="card" style="margin-bottom:20px">
            <h3>Choose Template</h3>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px">
                <label style="cursor:pointer">
                    <input type="radio" name="template" value="modern" checked onchange="generateResumePreview()">
                    <div style="border:2px solid #ddd;padding:12px;border-radius:8px;text-align:center">
                        <div style="background:#6C5CE7;color:white;padding:20px;border-radius:8px;margin-bottom:8px">Modern</div>
                        <small>Clean & ATS-friendly</small>
                    </div>
                </label>
                <label style="cursor:pointer">
                    <input type="radio" name="template" value="elegant" onchange="generateResumePreview()">
                    <div style="border:2px solid #ddd;padding:12px;border-radius:8px;text-align:center">
                        <div style="background:#1E293B;color:#E2E8F0;padding:20px;border-radius:8px;margin-bottom:8px">Elegant</div>
                        <small>Professional & minimal</small>
                    </div>
                </label>
                <label style="cursor:pointer">
                    <input type="radio" name="template" value="creative" onchange="generateResumePreview()">
                    <div style="border:2px solid #ddd;padding:12px;border-radius:8px;text-align:center">
                        <div style="background:linear-gradient(135deg,#8B5CF6,#EC4899);color:white;padding:20px;border-radius:8px;margin-bottom:8px">Creative</div>
                        <small>Bold & eye-catching</small>
                    </div>
                </label>
            </div>
        </div>

        <!-- Resume Form -->
        <div id="resume-form" class="card" style="display:block">
            <h3 style="margin-top:0">Edit Your Resume</h3>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px">
                <input id="res-name" class="input" placeholder="Full Name">
                <input id="res-title" class="input" placeholder="Professional Title">
                <input id="res-email" class="input" placeholder="Email">
                <input id="res-phone" class="input" placeholder="Phone">
                <input id="res-location" class="input" placeholder="City, Country">
                <input id="res-linkedin" class="input" placeholder="LinkedIn URL">
                <input id="res-github" class="input" placeholder="GitHub URL">
            </div>
            
            <h4 style="margin:20px 0 10px">Education</h4>
            <div id="education-container">
                <div class="education-entry" style="border:1px dashed var(--border);padding:12px;border-radius:8px;margin-bottom:10px">
                    <input placeholder="Degree (e.g. B.Sc Computer Science)" class="input" style="margin-bottom:8px">
                    <input placeholder="University" class="input" style="margin-bottom:8px">
                    <input placeholder="Graduation Year (e.g. 2025)" class="input">
                </div>
            </div>
            <button class="link-btn" onclick="addEducation()">+ Add Education</button>

            <h4 style="margin:20px 0 10px">Experience</h4>
            <div id="experience-container">
                <div class="experience-entry" style="border:1px dashed var(--border);padding:12px;border-radius:8px;margin-bottom:10px">
                    <input placeholder="Job Title" class="input" style="margin-bottom:8px">
                    <input placeholder="Company" class="input" style="margin-bottom:8px">
                    <input placeholder="Dates (e.g. Jan 2023 â€“ Present)" class="input" style="margin-bottom:8px">
                    <textarea placeholder="Responsibilities & Achievements" class="input" rows="3"></textarea>
                </div>
            </div>
            <button class="link-btn" onclick="addExperience()">+ Add Experience</button>

            <h4 style="margin:20px 0 10px">Skills</h4>
            <input id="res-skills" class="input" placeholder="e.g. Python, React, AWS, Leadership">

            <h4 style="margin:20px 0 10px">Projects (Optional)</h4>
            <div id="projects-container"></div>
            <button class="link-btn" onclick="addProject()">+ Add Project</button>

            <button class="btn" style="margin-top:20px;width:100%" onclick="saveResumeData()">Save & Preview</button>
        </div>

        <!-- Resume Preview -->
        <div id="resume-preview" class="card" style="margin-top:20px;overflow:hidden">
            <div style="text-align:center;padding:15px;background:#f1f5f9">
                <button class="btn" onclick="downloadResumePDF()">Download PDF</button>
                <button class="link-btn" onclick="checkATSCompatibility()" style="margin-left:10px">Check ATS Score</button>
            </div>
            <div id="resume-content" style="padding:40px;background:white;min-height:800px;font-family:Arial,sans-serif">
                <!-- Resume will be injected here -->
            </div>
        </div>

        <div id="ats-feedback" class="card" style="margin-top:15px;display:none"></div>
    </section>

    <section id="profile" class="page">
        <h2>Profile</h2>
        <div class="card">
            <div style="text-align:center;margin-bottom:20px">
                <img id="profile-avatar-large" class="avatar-large" src="https://via.placeholder.com/110/6C5CE7/FFFFFF?text=U">
                <input id="profile-avatar-file" type="file" accept="image/*" onchange="changeProfileAvatar(this)" style="margin-top:10px">
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
                <input id="profile-name-input" class="input" placeholder="Full Name">
                <input id="profile-username-input" class="input" placeholder="Username">
                <input id="profile-email-input" class="input" placeholder="Email">
                <input id="profile-education-input" class="input" placeholder="Education">
                <input id="profile-major-input" class="input" placeholder="Major">
                <input id="profile-gradyear-input" class="input" placeholder="Graduation Year">
                <input id="profile-skills-input" class="input" placeholder="Skills (comma separated)">
            </div>
            <button class="btn" style="margin-top:20px;width:100%" onclick="saveProfileEdits()">ðŸ’¾ Save Changes</button>
        </div>
    </section>

    <section id="xai" class="page">
        <h2>ðŸ¤– AI Career Assistant</h2>
        <div class="card" style="max-width:800px;margin:0 auto">
            <div id="ai-chat-output" class="chat-output" style="min-height:200px;border-bottom:1px solid var(--border);padding-bottom:15px;margin-bottom:15px">
                <div style="text-align:center;color:var(--muted);padding:20px 0">
                    <p>Ask me anything about:</p>
                    <ul style="text-align:left;display:inline-block;color:var(--muted);font-size:0.9rem">
                        <li>â€¢ Faculty recommendations</li>
                        <li>â€¢ Resume optimization</li>
                        <li>â€¢ Job search strategies</li>
                        <li>â€¢ Interview preparation</li>
                    </ul>
                </div>
            </div>
            <div style="display:flex;gap:10px">
                <input id="ai-chat-input" class="input" placeholder="Type your question here..." style="flex:1">
                <button class="btn" onclick="sendAIChatMessage()">Send</button>
            </div>
        </div>
    </section>

  </main>

  <div id="aiBubble" class="ai-bubble" onclick="toggleAIPopup()">ðŸ¤–</div>
  <div id="aiPopup" class="ai-popup">
    <div style="padding:15px;border-bottom:1px solid var(--border);font-weight:600;background:var(--card)">AI Assistant</div>
    <div id="ai-popup-output" class="chat-output">ðŸ’¡ Click the bubble to chat!</div>
    <div style="padding:12px;border-top:1px solid var(--border);background:var(--card)">
      <div style="display:flex;gap:10px">
        <input id="ai-popup-input" class="input" placeholder="Quick question..." style="flex:1">
        <button class="btn" onclick="sendAIPopupMessage()" style="padding:10px 12px">Send</button>
      </div>
    </div>
  </div>

  <script>
    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù€ JavaScript Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©
    // Ø£Ø¶Ù Ù‡Ø°Ø§ Ø¨Ø¹Ø¯ ÙƒÙ„ ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    document.getElementById('sidebar-toggle').addEventListener('click', () => {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('shifted');
    });

    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€ JavaScript ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·
    // Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ù† firebaseConfig Ø¥Ù„Ù‰ Ø¢Ø®Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª
    
    const firebaseConfig = {
        apiKey: "AIzaSyDoZebcPthz70oxICYAMm4W43JGXVUkTZE",
        authDomain: "edumate-8b4c3.firebaseapp.com",
        projectId: "edumate-8b4c3",
        storageBucket: "edumate-8b4c3.firebasestorage.app",
        messagingSenderId: "962420815642",
        appId: "1:962420815642:web:a8f38ee45034fdefb31ea3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    // Initialize users variable
    let users = JSON.parse(localStorage.getItem('edumate_users')) || {};

    /* --- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ --- */
    // ÙÙ‚Ø· ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ±:
    //. document.getElementById('mainContainer') Ø¥Ù„Ù‰ document.getElementById('mainContent')
    // 2. container.classList.toggle('shifted') Ø¥Ù„Ù‰ mainContent.classList.toggle('shifted')
    
     function firebaseLogin(providerType) {
            let provider;
            if (providerType === 'google') {
                provider = new firebase.auth.GoogleAuthProvider();
            } else if (providerType === 'github') {
                provider = new firebase.auth.GithubAuthProvider();
            }

            auth.signInWithPopup(provider)
            .then((result) => {
                const user = result.user;
                console.log("Logged in with " + providerType, user);
                    
                // Standardize data
                integrateSocialUser({
                    email: user.email || `${user.providerData[0].uid}@${providerType}.com`,
                    name: user.displayName || `${providerType} User`,
                    picture: user.photoURL,
                    method: providerType
                });
            }).catch((error) => {
                console.error(error);
                alert("Login Failed: " + error.message);
            });
        }

        // Unified function for both Google and GitHub
        function integrateSocialUser(socialUser) {
            const email = socialUser.email;
            const name = socialUser.name;
            const picture = socialUser.picture;
            
            let foundUsername = null;
            // Search existing users
            for(const k of Object.keys(users)){
                if(users[k].email && users[k].email.toLowerCase() === email.toLowerCase()){
                    foundUsername = users[k].username;
                    break;
                }
            }

            if(foundUsername) {
                loginUser(foundUsername, true);
            } else {
                // Create new user in local storage
                const baseUsername = email.split('@')[0].replace(/[^a-zA-Z0-9]/g, '');
                let newUsername = baseUsername;
                let counter = 1;
                while(users[newUsername]){
                newUsername = baseUsername + counter;
                counter++;
                }

                const newUser = {
                username: newUsername,
                name: name,
                email: email,
                password: `auth-${socialUser.method}-user`, 
                profilePic: picture,
                education: '', major: '', gradYear: '', skills: '' 
                };

                users[newUsername] = newUser;
                localStorage.setItem('edumate_users', JSON.stringify(users));
                loginUser(newUsername, true);
                alert(`Account created via ${socialUser.method}!`);
            }
        }


        
        
        /* Window Load */
        window.onload = function () {
        renderJobs(); 
        updateSidebarFromStorage();
        
        const logged = sessionStorage.getItem('edumate_logged') === '1';
        if(!logged && localStorage.getItem('edumate_seen_welcome') !== '1'){
            showPage('welcome'); localStorage.setItem('edumate_seen_welcome','1');
        } else if(logged){
            showPage('dashboard');
        } else {
            showPage('home');
        }
        applyStoredProfileToUI();
        }

        /* --- UI elements --- */
        const sidebar = document.getElementById('sidebar');
        const container = document.getElementById('mainContent')
        const sidebarToggle = document.getElementById('sidebar-toggle');

        let collapsed = false;
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                collapsed = !collapsed;
                sidebar.classList.toggle('collapsed', collapsed);
                container.classList.toggle('shifted', collapsed);
            });
        }

        function showPage(id) {
            const requiresAuth = ['dashboard', 'faculty', 'events', 'resume', 'jobs', 'xai', 'profile'];
            const logged = sessionStorage.getItem('edumate_logged') === '1';
            if (requiresAuth.includes(id) && !logged) {
                id = 'login';
                alert('Please sign in to access this page.');
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const el = document.getElementById(id);
            if (el) el.classList.add('active');
            container.scrollTop = 0;
            document.getElementById('aiPopup').classList.remove('active');
            
            // Update nav active state
            if (id === 'dashboard') renderJobs();
            if (id === 'events') loadEventsByMajor();
        }

        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        const storedTheme = localStorage.getItem('edumate_theme');
        if (storedTheme === 'dark') document.body.classList.add('dark-theme');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-theme');
                localStorage.setItem('edumate_theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
            });
        }

        /* --- Login / Register logic --- */
        function attemptLogin() {
            const emailOrUser = document.getElementById('login-email')?.value.trim() || '';
            const password = document.getElementById('login-password')?.value || '';
            
            if (!emailOrUser || !password) { 
                alert('Please enter email/username and password.'); 
                return; 
            }

            let matched = null;
            for (const k of Object.keys(users)) {
                const u = users[k];
                if ((u.username === emailOrUser) || (u.email && u.email.toLowerCase() === emailOrUser.toLowerCase())) {
                    matched = u;
                    break;
                }
            }
            
            if (matched && matched.password === password) {
                loginUser(matched.username, true);
            } else {
                alert('Invalid credentials. Try: student / pass123 or create an account.');
            }
        }

        function loginUser(username, remember = false) {
            sessionStorage.setItem('edumate_logged', '1');
            sessionStorage.setItem('edumate_username', username);
            if (remember) localStorage.setItem('edumate_last_user', username);
            
            updateSidebarFromStorage();
            applyStoredProfileToUI();
            document.getElementById('user-name').textContent = users[username].name || username;
            showPage('dashboard');
        }

        function signOut() {
            sessionStorage.removeItem('edumate_logged');
            sessionStorage.removeItem('edumate_username');
            showPage('login');
            updateSidebarFromStorage();
            document.getElementById('user-name').textContent = '';
        }

        function startRegistration() {
            const name = document.getElementById('reg-name')?.value.trim() || '';
            const username = document.getElementById('reg-username')?.value.trim() || '';
            const email = document.getElementById('reg-email')?.value.trim() || '';
            const password = document.getElementById('reg-password')?.value || '';
            const confirm = document.getElementById('reg-password-confirm')?.value || '';

            if (!name || !username || !email || !password || !confirm) { 
                alert('Please fill all fields.'); 
                return; 
            }
            if (password !== confirm) { 
                alert('Passwords do not match.'); 
                return; 
            }
            if (users[username]) { 
                alert('Username already exists.'); 
                return; 
            }
            
            const temp = { username, name, email, password, profilePic: 'https://via.placeholder.com/110/6C5CE7/FFFFFF?text=U', education:'', major:'', gradYear:'', skills:'' };
            sessionStorage.setItem('edumate_temp_registration', JSON.stringify(temp));
            fillInfoPageFromTemp();
            showPage('info');
        }

        function fillInfoPageFromTemp() {
            const temp = JSON.parse(sessionStorage.getItem('edumate_temp_registration') || '{}');
            if (!temp) return;
            document.getElementById('info-fullname').value = temp.name || '';
            document.getElementById('info-username').value = temp.username || '';
            document.getElementById('info-email').value = temp.email || '';
        }

        function previewInfoAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => { 
                    document.getElementById('info-avatar-preview').src = e.target.result; 
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function completeRegistration() {
            const temp = JSON.parse(sessionStorage.getItem('edumate_temp_registration') || '{}');
            if (!temp || !temp.username) { 
                alert('Registration data missing.'); 
                showPage('register'); 
                return; 
            }

            const username = document.getElementById('info-username').value.trim() || '';
            if (!username || (users[username] && username !== temp.username)) { 
                alert('Username is required or already taken.'); 
                return; 
            }

            const userObj = {
                ...temp,
                username,
                name: document.getElementById('info-fullname').value.trim() || '',
                email: document.getElementById('info-email').value.trim() || '',
                education: document.getElementById('info-education').value.trim() || '',
                major: document.getElementById('info-major').value.trim() || '',
                gradYear: document.getElementById('info-gradyear').value.trim() || '',
                skills: document.getElementById('info-skills').value.trim() || '',
                profilePic: document.getElementById('info-avatar-preview').src || temp.profilePic
            };

            users[username] = userObj;
            localStorage.setItem('edumate_users', JSON.stringify(users));
            sessionStorage.removeItem('edumate_temp_registration');
            loginUser(username, true);
            alert('Account created successfully! Welcome to Edumate.');
        }

        function updateSidebarFromStorage() {
            const uname = sessionStorage.getItem('edumate_username');
            const profileName = document.getElementById('profile-name');
            const profilePic = document.getElementById('profile-pic');
            
            if (uname && users[uname]) {
                profileName.textContent = users[uname].name || uname;
                profilePic.src = users[uname].profilePic || 'https://via.placeholder.com/44/6C5CE7/FFFFFF?text=U';
            } else {
                profileName.textContent = 'Guest';
                profilePic.src = 'https://via.placeholder.com/44/6C5CE7/FFFFFF?text=U';
            }
        }

        function applyStoredProfileToUI() {
            const uname = sessionStorage.getItem('edumate_username');
            if (!uname || !users[uname]) return;
            const u = users[uname];

            document.getElementById('profile-avatar-large').src = u.profilePic || 'https://via.placeholder.com/110/6C5CE7/FFFFFF?text=U';
            document.getElementById('profile-name-input').value = u.name || '';
            document.getElementById('profile-username-input').value = u.username || '';
            document.getElementById('profile-email-input').value = u.email || '';
            document.getElementById('profile-education-input').value = u.education || '';
            document.getElementById('profile-major-input').value = u.major || '';
            document.getElementById('profile-gradyear-input').value = u.gradYear || '';
            document.getElementById('profile-skills-input').value = u.skills || '';
            document.getElementById('user-name') && (document.getElementById('user-name').textContent = u.name || u.username);
        }

        function changeProfileAvatar(input) {
            if (!input.files || !input.files[0]) return;
            const reader = new FileReader();
            reader.onload = e => { 
                document.getElementById('profile-avatar-large').src = e.target.result; 
            };
            reader.readAsDataURL(input.files[0]);
        }

        function saveProfileEdits() {
            const uname = sessionStorage.getItem('edumate_username');
            if (!uname || !users[uname]) { 
                alert('Please login first.'); 
                return; 
            }
            
            const u = users[uname];
            const newUsername = document.getElementById('profile-username-input').value.trim() || '';
            
            if (newUsername && newUsername !== u.username && users[newUsername]) { 
                alert('Username already taken.'); 
                return; 
            }
            
            const updated = {
                ...u,
                username: newUsername || u.username,
                name: document.getElementById('profile-name-input').value.trim() || u.name,
                email: document.getElementById('profile-email-input').value.trim() || u.email,
                education: document.getElementById('profile-education-input').value.trim() || u.education,
                major: document.getElementById('profile-major-input').value.trim() || u.major,
                gradYear: document.getElementById('profile-gradyear-input').value.trim() || u.gradYear,
                skills: document.getElementById('profile-skills-input').value.trim() || u.skills,
                profilePic: document.getElementById('profile-avatar-large').src || u.profilePic
            };

            if (newUsername && newUsername !== u.username) {
                delete users[u.username];
                sessionStorage.setItem('edumate_username', newUsername);
            }
            
            users[updated.username] = updated;
            localStorage.setItem('edumate_users', JSON.stringify(users));
            updateSidebarFromStorage();
            applyStoredProfileToUI();
            alert('Profile updated successfully!');
        }

        /* --- AI Chat --- */
        function toggleAIPopup() {
            const popup = document.getElementById('aiPopup');
            popup.classList.toggle('active');
        }

        function sendAIChatMessage() {
            const input = document.getElementById('ai-chat-input');
            const out = document.getElementById('ai-chat-output');
            if (!input || !out) return;
            
            const txt = input.value.trim();
            if (!txt) return;
            
            out.innerHTML += `<div style="margin-bottom:15px"><strong style="color:var(--primary)">You:</strong> ${escapeHtml(txt)}</div>`;
            out.innerHTML += `<div style="margin-bottom:15px"><strong style="color:#10B981">AI:</strong> ${escapeHtml(generateAIResponse(txt))}</div>`;
            input.value = '';
            out.scrollTop = out.scrollHeight;
        }

        function sendAIPopupMessage() {
            const input = document.getElementById('ai-popup-input');
            const out = document.getElementById('ai-popup-output');
            if (!input || !out) return;
            
            const txt = input.value.trim();
            if (!txt) return;
            
            out.innerHTML += `<div style="margin-bottom:10px"><strong>You:</strong> ${escapeHtml(txt)}</div>`;
            out.innerHTML += `<div style="margin-bottom:15px"><strong>AI:</strong> ${escapeHtml(generateAIResponse(txt))}</div>`;
            input.value = '';
            out.scrollTop = out.scrollHeight;
        }

        function generateAIResponse(input) {
            const lower = input.toLowerCase();
            if (lower.includes('faculty') || lower.includes('university')) {
                return 'Based on your profile, I recommend applying to Computer Science programs at top universities. Focus on your Python and SQL skills in applications!';
            }
            if (lower.includes('resume') || lower.includes('ats')) {
                return 'Your resume looks good! Add these keywords: "Agile", "React", "Cloud Computing" to improve ATS scores by 15%.';
            }
            if (lower.includes('job') || lower.includes('interview')) {
                return 'For software engineering roles, practice LeetCode medium problems and prepare STAR method answers for behavioral questions.';
            }
            if (lower.includes('hello') || lower.includes('hi')) {
                return 'Hello! How can I help you with your career today?';
            }
            return `Great question about "${input}"! I recommend focusing on building real projects and networking on LinkedIn. Need specific advice?`;
        }

        function escapeHtml(s) {
            return (s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
        }

        /* --- Events Data --- */
        const eventsData = {
            cs: [
                { title: "AI & ML Summit 2026", img: "https://www.adamasintel.com/wp-content/uploads/2024/04/AdobeStock_658654791-2400x1345.jpeg", desc: "Latest AI trends and hands-on workshops" },
                { title: "Cybersecurity Challenge", img: "https://www.hollywoodledletters.ie/wp-content/uploads/2019/10/UPSTARTER-MANSION-HOUSE-HOLLYWOOD-LED-LETTERS-1024x768.jpg", desc: "Ethical hacking competition + career fair" }
            ],
            masscomm: [
                { title: "Digital Media Expo", img: "https://images.pushsquare.com/98564c6a76670/egx-playstation-4-ps4-1.large.jpg", desc: "Content creation and influencer strategies" },
                { title: "Comic Con New York", img: "https://i0.wp.com/gaming-age.com/wp-content/uploads/2022/09/NYCC-2022-Header.jpg?fit=1280%2C852&ssl=1", desc: "Pop culture, networking, and media jobs" }
            ],
            business: [
                { title: "Startup Pitch Competition", img: "https://www.fluxxconference.com/wp-content/uploads/2025/03/About-Conference-3-1-550x785.jpg", desc: "Pitch your idea + meet investors" },
                { title: "Finance & Investment Summit", img: "https://www.andreamatone.com/wp-content/uploads/2015/04/event-conference-photography.jpg", desc: "Stock trading, crypto, and career paths" }
            ],
            engineering: [
                { title: "Robotics & Automation Expo", img: "https://tse1.mm.bing.net/th/id/OIP.NyqJgj7GgaFTgf-VgyT0owHaE7?rs=1&pid=ImgDetMain&o=7&rm=3", desc: "Live robot demos + engineering jobs" },
                { title: "Civil Engineering Conference", img: "https://moneyfactsgroup.co.uk/media/bmifehmz/jb-268.jpg", desc: "Mega projects tour + internships" }
            ],
            medicine: [
                { title: "Medical Research Symposium", img: "https://tse4.mm.bing.net/th/id/OIP.IOYLzAcKj_49TH68tQ2lmQAAAA?rs=1&pid=ImgDetMain&o=7&rm=3", desc: "Latest healthcare innovations" },
                { title: "First Aid & CPR Workshop", img: "https://tse4.mm.bing.net/th/id/OIP.IOYLzAcKj_49TH68tQ2lmQAAAA?rs=1&pid=ImgDetMain&o=7&rm=3", desc: "Practical emergency medical training" }
            ]
        };

        function loadEventsByMajor() {
            const major = document.getElementById("majorSelect").value;
            const container = document.getElementById("eventsContainer");
            
            if (!major) { 
                container.innerHTML = `<div class="card" style="text-align:center;color:var(--muted)"><p>Select a major to see relevant events</p></div>`;
                return; 
            }
            
            const selectedEvents = eventsData[major] || [];
            container.innerHTML = selectedEvents.map(e => `
                <div class="card event-card">
                    <img src="${e.img}" alt="${e.title}" onerror="this.src='https://via.placeholder.com/140x100/6C5CE7/FFFFFF?text=EVENT'">
                    <div style="flex:1">
                        <h3>${e.title}</h3>
                        <p style="color:var(--muted);margin:5px 0">${e.desc}</p>
                        <button class="btn" style="font-size:0.85rem;padding:6px 12px">RSVP</button>
                    </div>
                </div>
            `).join("");
        }
        // Resume Data Management
        let resumeData = {
            name: "Mohamed Ahmed",
            title: "Software Engineer",
            email: "mohamed@example.com",
            phone: "+20 123 456 7890",
            location: "Cairo, Egypt",
            linkedin: "linkedin.com/in/mohamed",
            github: "github.com/mohamed",
            education: [
                { degree: "B.Sc Computer Science", school: "Cairo University", year: "2022 â€“ 2026" }
            ],
            experience: [
                { title: "Frontend Developer Intern", company: "TechCorp", dates: "Summer 2024", desc: "Built responsive web apps using React and Tailwind" }
            ],
            skills: "Python, JavaScript, React, Node.js, SQL, Git, AWS",
            projects: []
        };

        // Load from localStorage if exists
        if (localStorage.getItem('edumate_resume')) {
            resumeData = JSON.parse(localStorage.getItem('edumate_resume'));
        }

        function showResumeForm() {
            document.getElementById('resume-form').style.display = 'block';
            loadResumeDataIntoForm();
        }

        function loadResumeDataIntoForm() {
            document.getElementById('res-name').value = resumeData.name || '';
            document.getElementById('res-title').value = resumeData.title || '';
            document.getElementById('res-email').value = resumeData.email || '';
            document.getElementById('res-phone').value = resumeData.phone || '';
            document.getElementById('res-location').value = resumeData.location || '';
            document.getElementById('res-linkedin').value = resumeData.linkedin || '';
            document.getElementById('res-github').value = resumeData.github || '';
            document.getElementById('res-skills').value = resumeData.skills || '';

            // Populate dynamic sections
            document.getElementById('education-container').innerHTML = '';
            resumeData.education.forEach(addEducationEntry);

            document.getElementById('experience-container').innerHTML = '';
            resumeData.experience.forEach(addExperienceEntry);

            document.getElementById('projects-container').innerHTML = '';
            resumeData.projects.forEach(addProjectEntry);
        }

        function addEducation(entry = {}) {
            const container = document.getElementById('education-container');
            const div = document.createElement('div');
            div.className = 'education-entry';
            div.style = 'border:1px dashed #ccc;padding:12px;border-radius:8px;margin-bottom:10px';
            div.innerHTML = `
                <input placeholder="Degree" class="input" value="${entry.degree || ''}" style="margin-bottom:8px">
                <input placeholder="University" class="input" value="${entry.school || ''}" style="margin-bottom:8px">
                <input placeholder="Year (e.g. 2022 â€“ 2026)" class="input" value="${entry.year || ''}">
                <button class="link-btn" style="color:#ef4444;margin-top:8px" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(div);
        }

        function addExperience(entry = {}) {
            const container = document.getElementById('experience-container');
            const div = document.createElement('div');
            div.className = 'experience-entry';
            div.style = 'border:1px dashed #ccc;padding:12px;border-radius:8px;margin-bottom:10px';
            div.innerHTML = `
                <input placeholder="Job Title" class="input" value="${entry.title || ''}" style="margin-bottom:8px">
                <input placeholder="Company" class="input" value="${entry.company || ''}" style="margin-bottom:8px">
                <input placeholder="Dates" class="input" value="${entry.dates || ''}" style="margin-bottom:8px">
                <textarea placeholder="Key achievements..." class="input" rows="3">${entry.desc || ''}</textarea>
                <button class="link-btn" style="color:#ef4444;margin-top:8px" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(div);
        }

        function addProject(entry = {}) {
            const container = document.getElementById('projects-container');
            const div = document.createElement('div');
            div.style = 'border:1px dashed #ccc;padding:12px;border-radius:8px;margin-bottom:10px';
            div.innerHTML = `
                <input placeholder="Project Name" class="input" value="${entry.name || ''}" style="margin-bottom:8px">
                <input placeholder="Tech Stack" class="input" value="${entry.tech || ''}" style="margin-bottom:8px">
                <textarea placeholder="Description" class="input" rows="2">${entry.desc || ''}</textarea>
                <button class="link-btn" style="color:#ef4444;margin-top:8px" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(div);
        }

        function saveResumeData() {
            resumeData.name = document.getElementById('res-name').value.trim();
            resumeData.title = document.getElementById('res-title').value.trim();
            resumeData.email = document.getElementById('res-email').value.trim();
            resumeData.phone = document.getElementById('res-phone').value.trim();
            resumeData.location = document.getElementById('res-location').value.trim();
            resumeData.linkedin = document.getElementById('res-linkedin').value.trim();
            resumeData.github = document.getElementById('res-github').value.trim();
            resumeData.skills = document.getElementById('res-skills').value.trim();

            // Save dynamic entries
            resumeData.education = Array.from(document.querySelectorAll('.education-entry')).map(el => ({
                degree: el.children[0].value,
                school: el.children[1].value,
                year: el.children[2].value
            }));

            resumeData.experience = Array.from(document.querySelectorAll('.experience-entry')).map(el => ({
                title: el.children[0].value,
                company: el.children[1].value,
                dates: el.children[2].value,
                desc: el.children[3].value
            }));

            localStorage.setItem('edumate_resume', JSON.stringify(resumeData));
            alert('Resume saved!');
            generateResumePreview();
        }

        function generateResumePreview() {
            const template = document.querySelector('input[name="template"]:checked').value;
            const content = document.getElementById('resume-content');

            const templates = {
                modern: generateModernTemplate,
                elegant: generateElegantTemplate,
                creative: generateCreativeTemplate
            };

            content.innerHTML = templates[template] ? templates[template]() : generateModernTemplate();
        }

        function generateModernTemplate() {
            return `
            <div style="max-width:800px;margin:0 auto;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#2d2d2d;line-height:1.5">
                <header style="text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:4px solid #6C5CE7">
                    <h1 style="margin:0;font-size:2.8em;color:#6C5CE7">${resumeData.name || 'Your Name'}</h1>
                    <p style="margin:10px 0;font-size:1.2em;color:#555">${resumeData.title || 'Professional Title'}</p>
                    <p style="margin:5px 0;color:#666">
                        ${resumeData.email} â€¢ ${resumeData.phone} â€¢ ${resumeData.location}<br>
                        ${resumeData.linkedin ? `<a href="#" style="color:#6C5CE7">LinkedIn</a> â€¢ ` : ''}
                        ${resumeData.github ? `<a href="#" style="color:#6C5CE7">GitHub</a>` : ''}
                    </p>
                </header>

                ${resumeData.education.length ? `<h2 style="color:#6C5CE7;border-bottom:2px solid #6C5CE7;padding-bottom:5px">Education</h2>` : ''}
                ${resumeData.education.map(e => `
                    <div style="margin-bottom:20px">
                        <strong style="font-size:1.1em">${e.degree}</strong><br>
                        <em>${e.school} â€¢ ${e.year}</em>
                    </div>
                `).join('')}

                ${resumeData.experience.length ? `<h2 style="color:#6C5CE7;border-bottom:2px solid #6C5CE7;padding-bottom:5px">Experience</h2>` : ''}
                ${resumeData.experience.map(exp => `
                    <div style="margin-bottom:20px">
                        <div style="display:flex;justify-content:space-between">
                            <strong style="font-size:1.1em">${exp.title}</strong>
                            <span style="color:#666">${exp.dates}</span>
                        </div>
                        <em>${exp.company}</em>
                        <ul style="margin:8px 0;padding-left:20px">
                            <li>${exp.desc.split('\n').join('</li><li>')}</li>
                        </ul>
                    </div>
                `).join('')}

                <h2 style="color:#6C5CE7;border-bottom:2px solid #6C5CE7;padding-bottom:5px">Skills</h2>
                <p style="background:#f0f4ff;padding:12px;border-radius:8px;font-weight:500">
                    ${resumeData.skills || 'Python, JavaScript, React, SQL, Git, AWS'}
                </p>
            </div>`;
        }

        // change templates

        function generateElegantTemplate() {
            return generateModernTemplate().replace(/#6C5CE7/g, '#1E293B');
        }

        function generateCreativeTemplate() {
            return `
            <div style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:40px;min-height:100vh">
                <div style="background:rgba(255,255,255,0.95);color:#222;padding:40px;border-radius:16px">
                    ${generateModernTemplate().split('<header')[1] ? '<header' + generateModernTemplate().split('<header')[1] : ''}
                </div>
            </div>`;
        }

        // Download resume as PDF 
        function downloadResumePDF() {
            const element = document.getElementById('resume-content');
            html2pdf()
                .set({ margin: 10, filename: `${resumeData.name || 'Resume'}_Edumate.pdf`, html2canvas: { scale: 2 } })
                .from(element)
                .save();
        }

        // Load html2pdf library
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
        document.head.appendChild(script);

        // Initialize on resume page
        if (window.location.hash === '#resume' || document.getElementById('resume').classList.contains('active')) {
            setTimeout(generateResumePreview, 500);
        }
            

        /* --- Jobs --- */
        const jobsData = [
            { 
                title: 'Software Engineer', 
                company: 'Iskraemco', 
                match: 92, 
                reason: 'Strong Python + SQL skills', 
                salary: '$65K - $85K',
                applyUrl: 'https://iskraemeco.com/' 
            },
            { 
                title: 'Frontend Developer', 
                company: 'Amazon', 
                match: 88, 
                reason: 'JavaScript experience', 
                salary: '$70K - $90K',
                applyUrl: 'https://www.amazon.jobs/en/jobs/123456/frontend-developer' 
            },
            { 
                title: 'Data Analyst', 
                company: 'e&', 
                match: 85, 
                reason: 'Analytical skills', 
                salary: '$60K - $80K',
                applyUrl: 'https://www.eand.com.eg/StaticFiles/career/#/home' 
            },
        ];

        function renderJobs() {
            const list = document.getElementById('jobs-list');
            if (!list) return;

            list.innerHTML = jobsData.map(j => `
                <div class="card">
                    <h3>${j.title}</h3>
                    <p style="font-weight:600">${j.company}</p>
                    <p style="color:var(--muted)">${j.reason} â€¢ ${j.match}% match</p>
                    <p style="font-size:0.9rem;color:var(--primary)">${j.salary}</p>
                    
                    <a href="${j.applyUrl}" target="_blank" rel="noopener" style="text-decoration:none;display:block;margin-top:10px">
                        <button class="btn" style="width:100%;font-size:0.9rem">Apply Now</button>
                    </a>
                </div>
            `).join('');
        }
        /* --- ATS Check --- */
        function checkATSCompatibility() {
            const feedback = document.getElementById('ats-feedback');
            feedback.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <div>
                        <strong style="color:#10B981">ATS Score: 85% âœ…</strong><br>
                        <span style="color:var(--muted);font-size:0.9rem">Good job! Your resume passes most systems.</span>
                    </div>
                    <div style="text-align:right">
                        <strong style="color:#F59E0B">âš ï¸ Missing Keywords:</strong><br>
                        <span style="font-size:0.85rem">â€¢ Agile Methodology<br>â€¢ React.js<br>â€¢ AWS Cloud</span>
                    </div>
                </div>
            `;
            feedback.style.display = 'block';
        }

        
        /* --- Initialize App --- */
        window.addEventListener('load', function() {
            updateSidebarFromStorage();
            applyStoredProfileToUI();
            
            const logged = sessionStorage.getItem('edumate_logged') === '1';
            const seenWelcome = localStorage.getItem('edumate_seen_welcome') === '1';
            
            if (!logged && !seenWelcome) {
                showPage('welcome');
                localStorage.setItem('edumate_seen_welcome', '1');
            } else if (logged) {
                showPage('dashboard');
                renderJobs();
            } else {
                showPage('login'); // Default to login
            }

            setTimeout(() => {
                if (sessionStorage.getItem('edumate_logged') !== '1') {
                    const demoUser = users.student;
                    loginUser(demoUser.username, true);
                }
            }, 2000);

           

            // Enter to send messages
            document.getElementById('ai-chat-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendAIChatMessage();
            });
            document.getElementById('ai-popup-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendAIPopupMessage();
            });
        });

        // Close popup 
        document.addEventListener('click', (e) => {
            const popup = document.getElementById('aiPopup');
            const bubble = document.getElementById('aiBubble');
            if (popup.classList.contains('active') && !popup.contains(e.target) && !bubble.contains(e.target)) {
                popup.classList.remove('active');
            }
        });
    
  </script>
</body>
</html>